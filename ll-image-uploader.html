<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-input/iron-input.html">
<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">

<!--
An element providing a solution to no problem in particular.

Example:

    <ll-image-uploader></ll-image-uploader>

@demo
-->
<dom-module id="ll-image-uploader">

  <style is="custom-style">

    :host {
      display: block;
      box-sizing: border-box;

      @apply(--layout-horizontal);
    }

    input {
      border: 1px solid red;
      padding: 10px;
    }

    ul {
      @apply(--layout-horizontal)
    }


  </style>

  <link rel="import" type="css" href="ll-image-uploader.css"/>

  <template>
    <form is="iron-form" enctype="multipart/form-data" action="[[url]]" method="[[method]]" flex>
      <input type="file" is="iron-input" id="uploads" multiple on-change="_uploadsChanged">
    </form>
    <button on-click="_cancelUpload">Cancel</button>
    <button disabled$="[[_showUpload(_files)]]">Upload</button>
    <ul>
      <template is="dom-repeat" items="[[_files]]">
        <li><span>{{item.name}}</span></li>
      </template>
    </ul>
  </template>

</dom-module>

<script>

  Polymer({

    is: 'll-image-uploader',

    properties: {

      /**
       * The url for the api to publish
       */
      url: {
        type: String,
        reflectToAttribute: true
      },

      /**
       * The HTTP method 'POST', 'PUT', etc
       */
      method: {
        type: String,
        value: 'POST'
      },

      /**
       * The files that have been 'dragged' onto the element
       */
      _files: {
        type: Array,
        value: []
      }

    },

    /**
     * Upload files changed
     * @private
     */
    _uploadsChanged: function() {
      var files = [];
      var uploadFiles = this.$.uploads.files;
      for (var i = 0; i < uploadFiles.length; i++) {
        files.push(uploadFiles.item(i));
      }
      this._files = files;
    },

    /**
     * Resets the upload
     * @param e
     * @private
     */
    _cancelUpload: function(e) {
      var form = Polymer.dom(this.root).querySelector('form');
      form.reset();
      this._files = [];
    },

    /**
     * Determines if the upload button should be enabled
     * @param files
     * @returns {boolean}
     * @private
     */
    _showUpload: function(files) {
      return files.length == 0;
    }

  });

</script>
